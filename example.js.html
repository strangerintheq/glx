<!DOCTYPE html>
<html>
<style>
    body {
        margin: 0;
        overflow: hidden
    }

    canvas {
        position: absolute;
        width: 100%;
        height: 100%;
    }
</style>
<body>
<script src="glx.js"></script>
<script src="FullScreenTriangle.js"></script>
<script src="SoundCloudAudioSource.js"></script>
<!--<script src="https://connect.soundcloud.com/sdk/sdk-3.3.1.js"></script>-->
<!--<script src="Souncloud.js"></script>-->
<!--<audio id="player"></audio>-->
<script>
    var fragCode = `
         uniform vec4 mr;
         void main(void) {
           vec2 q =(gl_FragCoord.xy*2.0 - mr.ba) / mr.b;
           for(int i = 0; i < 6; i++) {
             vec2 c = mr.xy/mr.b;
             q = abs(q)/dot(q,q) -cos(c*q);
           }
           gl_FragColor = vec4( 1.0 - q.y/q.x, q, 1.0);
         }
         `;

    var fst = FullScreenTriangle(fragCode);
    var mr = fst.triangleProgram.uniform('4f', 'mr');

    // var audioSource = new SoundCloudAudioSource('player');

    upd();

    // addEventListener('click', function () {
    //     var draw = function() {
    //         // you can then access all the frequency and volume data
    //         // and use it to draw whatever you like on your canvas
    //         for(var t = 0; t < audioSource.streamData.length; t ++) {
    //             // do something with each value. Here's a simple example
    //             var val = audioSource.streamData[t];
    //             console.log(t + ' ' + val)
    //             // use lines and shapes to draw to the canvas is various ways. Use your imagination!
    //         }
    //         requestAnimationFrame(draw);
    //     };
    //
    //    // audioSource.playStream('https://soundcloud.com/kukangherita/tribal-muntaner');
    //     draw();
    // });

    addEventListener('mousemove', upd);
    addEventListener('touchmove', upd);

    function upd(e) {
        var h = fst.gl.drawingBufferHeight;
        var w = fst.gl.drawingBufferWidth;
        var x = e ? e.clientX : 0;
        var y = e ? h - e.clientY : 0;
        mr.set(x, y, w, h);
        fst.draw();
    }

</script>
</body>
</html>