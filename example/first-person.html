<!DOCTYPE html>
<html>
<body>
<link href="fullscreen.css" rel="stylesheet">
<script src="../js/glx.js"></script>
<script src="../js/ShaderLoader.js"></script>
<script src="../js/mouse/Mouse3d.js"></script>
<script src="../js/mouse/FirstPersonControls.js"></script>
<script>

    FirstPersonControls.init();

    let glx = GLx()
        .shader('triangle', '../glsl/full-screen-triangle.glsl')
        .shader('noise', 'noise.glsl')
        .shader('main', 'main.glsl')
        .onLoad(function () {
            let l = glx.shaderLib;
            l.triangle && l.main && l.noise && init();
        });

    document.body.appendChild(glx.canvas);

    function init() {

        let gl = glx.ctx;
        let vertices = glx.buffer(glx.meshes.FULL_SCREEN_TRIANGLE);
        let tex = glx.texture();
        tex.bind().resize(512, 512).framebuffer().bind();
        glx.program('triangle', 'noise').use()
            .attribute("coords", 2).bind(vertices);
        glx.resize(512, 512).draw(3);
        gl.bindFramebuffer(gl.FRAMEBUFFER, null);

        let mainProgram = glx.program('triangle', 'main').use()
            .attribute("coords", 2).bind(vertices);
        let resolution = mainProgram.uniform('2f', 'resolution');
        let lookAt = mainProgram.uniform('3f', 'lookAt');
        let eye = mainProgram.uniform('3f', 'eye');
        //let noise = mainProgram.uniform('1i', 'noiseTexture');
        //  gl.activeTexture(gl.TEXTURE0);
        //  tex.bind();
        //  noise.set(0);

        animate();

        function animate() {
            requestAnimationFrame(animate);
            resolution.set(gl.drawingBufferWidth, gl.drawingBufferHeight);
            eye.set(FirstPersonControls.eye);
            lookAt.set(FirstPersonControls.forward);
            glx.resize().draw(3);
        }
    }
</script>
</body>
</html>